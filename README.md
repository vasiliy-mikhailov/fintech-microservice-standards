# **Стандарт микросервисов. Версия X.Y**  
**Дата выпуска:** 2025-01-01  
**Владелец стандарта:** CIO  
**Статус:** *Обязателен для всех новых и перерабатываемых систем организации*  

---

## **1. Цели и область применения**
Настоящий стандарт определяет принципы проектирования, разработки, эксплуатации и эволюции микросервисной архитектуры в крупной финансовой организации.  
Стандарт применяется ко всем ИТ-системам, обеспечивающим банковские процессы с высокими требованиями к надёжности, безопасности, качеству данных и SLA/SLO.  
Документ предназначен для всех команд, создающих и эксплуатирующих микросервисы, включая Core IT.

---

## **2. Предусловия**
- В организации определены бизнес-сервисы, создающие ценность, и назначены их бизнес-владельцы.  
- Данные возникают в ходе бизнес-процессов; владельцами данных являются владельцы соответствующих процессов.  
- ИТ формирует команды под конкретного бизнес-заказчика и создаёт микросервисы для обеспечения работы конкретного бизнес-сервиса.  
- Каждый сервис в организации является поставщиком ценности другим сервисам; часть микросервисов используется несколькими бизнес-сервисами и относится к Core IT.  

---

# **3. Принципы развития микросервисов (2025–2027)**

Ниже приведена основная таблица принципов. Все критерии измеримые, автоматизируемые, соответствуют современным финансовым и cloud-native практикам.

---

## **Принцип 1. Domain-Driven Boundaries / Доменно-ориентированные границы**

| Поле | Описание |
|------|----------|
| **Принцип** | Domain-Driven Boundaries / Доменно-ориентированные границы |
| **Мотивация** | Устойчивые границы сервисов уменьшают связанность и повышают управляемость сложных финансовых доменов. |
| **Метрики** | EN: % of services with single bounded context ≥95%; APIs leaking internal schema =0%.<br>RU: доля сервисов с одним bounded context ≥95%; API, раскрывающие внутреннюю модель данных =0%. |
| **Положительные примеры** | 1. Единый источник данных клиента.<br>2. API без деталей внутренней БД.<br>3. Один bounded context на сервис.<br>4. Доменные события.<br>5. Расчётный сервис не использует чужие сущности напрямую. |
| **Отрицательные примеры** | 1. Общие таблицы для нескольких сервисов.<br>2. Логика в API Gateway.<br>3. Передача схем БД в API.<br>4. Дублирование KYC-логики.<br>5. Зависимость от DTO другого сервиса. |
| **Риски нарушения** | Рост связанности, высокая стоимость изменений. |
| **Методика проверки** | Анализ API/схем, архитектурные ревью. |
| **Статус** | **CORE** |

---

## **Принцип 2. Service Autonomy / Автономия сервисов**

| Поле | Описание |
|------|----------|
| **Принцип** | Service Autonomy / Автономия сервисов |
| **Мотивация** | Автономные сервисы обеспечивают масштабируемость и надёжность. |
| **Метрики** | EN: Independent deploy success ≥99%; Shared DB count =0.<br>RU: успешные независимые деплои ≥99%; число сервисов с общей БД =0. |
| **Положительные примеры** | 1. Своё хранилище у каждого сервиса.<br>2. Раздельные CI/CD пайплайны.<br>3. Externalized config.<br>4. Circuit breaker.<br>5. Отдельные SLA/SLO. |
| **Отрицательные примеры** | 1. Одна БД на 10 сервисов.<br>2. Общие конфиги в Git.<br>3. Релиз требует деплоя других сервисов.<br>4. Нет health-checks.<br>5. Cron-зависимости. |
| **Риски нарушения** | Каскадные сбои, блокировка релизов. |
| **Методика проверки** | Анализ зависимостей, схем БД и CI/CD. |
| **Статус** | **CORE** |

---

## **Принцип 3. API First & Backward Compatibility / API-ориентированность и обратная совместимость**

| Поле | Описание |
|------|----------|
| **Принцип** | API First & Backward Compatibility / API-ориентированность |
| **Мотивация** | Снижение интеграционных рисков и повышение стабильности релизов. |
| **Метрики** | EN: Breaking changes =0; Contract test coverage ≥95%.<br>RU: несовместимые изменения =0; покрытие контракт-тестами ≥95%. |
| **Положительные примеры** | 1. Версионирование API.<br>2. Consumer-driven контракты.<br>3. Депрекация с периодом миграции.<br>4. Idempotent API.<br>5. Строгие схемы OpenAPI/AsyncAPI. |
| **Отрицательные примеры** | 1. Удаление полей без уведомления.<br>2. Раскрытие внутренней схемы.<br>3. Chatty API.<br>4. Неоднозначные ошибки.<br>5. Непрозрачная логика. |
| **Риски нарушения** | Инциденты интеграций, остановка процессов. |
| **Методика проверки** | Валидация OpenAPI/AsyncAPI, тесты контрактов. |
| **Статус** | **CORE** |

---

## **Принцип 4. Event-Driven Reliability / Надёжность событийной архитектуры**

| Поле | Описание |
|------|----------|
| **Принцип** | Event-Driven Reliability |
| **Мотивация** | Асинхронность повышает масштабируемость и снижает связанность. |
| **Метрики** | EN: Event delivery ≥99.99%; Duplicate handling =100%; Schema version consistency ≥98%.<br>RU: доставка ≥99.99%; обработка дубликатов =100%; корректность схем ≥98%. |
| **Положительные примеры** | 1. Идемпотентные обработчики.<br>2. Outbox-паттерн.<br>3. DLQ.<br>4. AsyncAPI схемы.<br>5. Retention policies. |
| **Отрицательные примеры** | 1. Зависимость от порядка событий.<br>2. Сущности БД в событиях.<br>3. Generic events.<br>4. Нет retry.<br>5. Нет мониторинга лагов. |
| **Риски нарушения** | Потеря событий, несогласованность данных. |
| **Методика проверки** | Анализ брокера, схем, нагрузочные тесты. |
| **Статус** | **CORE** |

---

## **Принцип 5. Observability by Design / Наблюдаемость по умолчанию**

| Поле | Описание |
|------|----------|
| **Принцип** | Observability by Design |
| **Мотивация** | Для выполнения SLA требуется прозрачность состояния системы. |
| **Метрики** | EN: Trace coverage ≥95%; Log completeness ≥99%; Metrics export =100%.<br>RU: покрытие трассировками ≥95%; полнота логов ≥99%; экспорт метрик =100%. |
| **Положительные примеры** | 1. OpenTelemetry.<br>2. Корреляция trace ID.<br>3. Error/Latency/Saturation метрики.<br>4. Готовые дашборды.<br>5. Алерты по SLO. |
| **Отрицательные примеры** | 1. Логи без trace ID.<br>2. Нет агрегации метрик.<br>3. Логи в контейнере.<br>4. Нет SLO.<br>5. Нет алертов. |
| **Риски нарушения** | Долгие расследования, нарушение SLA. |
| **Методика проверки** | Проверка метрик, логов, трассировок. |
| **Статус** | **CORE** |

---

## **Принцип 6. Zero Trust & mTLS Everywhere / Zero Trust и mTLS**

| Поле | Описание |
|------|----------|
| **Принцип** | Zero Trust & mTLS Everywhere |
| **Мотивация** | Максимальная защита данных и трафика. |
| **Метрики** | EN: Encrypted calls =100%; Unauthorized access =0; Secret rotation ≤90 days.<br>RU: шифрование вызовов =100%; несанкционированные запросы =0; ротация секретов ≤90 дней. |
| **Положительные примеры** | 1. mTLS через сервис-mesh.<br>2. RBAC/ABAC.<br>3. Secret Manager.<br>4. Least privilege.<br>5. Автоматическая ротация ключей. |
| **Отрицательные примеры** | 1. Пароли в конфиге.<br>2. TLS отключён.<br>3. Хардкод токенов.<br>4. Открытые порты.<br>5. Логи с персональными данными. |
| **Риски нарушения** | Компрометация данных, регуляторные штрафы. |
| **Методика проверки** | Security scans, mesh-конфигурации, анализ трафика. |
| **Статус** | **CORE** |

---

## **Принцип 7. GitOps & Automated Delivery / GitOps и автоматизированная доставка**

| Поле | Описание |
|------|----------|
| **Принцип** | GitOps & Automated Delivery |
| **Мотивация** | Минимизация ручных ошибок и прозрачная поставка. |
| **Метрики** | EN: Automated deployments ≥98%; Config drift =0; Pipeline success ≥99%.<br>RU: авто-деплои ≥98%; дрейф конфигурации =0; успех пайплайнов ≥99%. |
| **Положительные примеры** | 1. ArgoCD/Flux.<br>2. Full CI/CD.<br>3. Policy as Code.<br>4. Rollbacks.<br>5. Pipeline security scanning. |
| **Отрицательные примеры** | 1. Ручное редактирование манифестов.<br>2. Деплой через ноутбук.<br>3. Несогласованные конфиги.<br>4. Нет rollback.<br>5. Нет проверок безопасности. |
| **Риски нарушения** | Нестабильные релизы, невозможность аудита. |
| **Методика проверки** | GitOps-сканеры, аудит пайплайнов. |
| **Статус** | **CORE** |

---

## **Принцип 8. Resilience & Chaos Testing / Устойчивость и хаос-тестирование**

| Поле | Описание |
|------|----------|
| **Принцип** | Resilience & Chaos Testing |
| **Мотивация** | Финансовые сервисы должны выдерживать частичные сбои. |
| **Метрики** | EN: MTTR ≤5 min; Circuit-breaker coverage ≥90%; Chaos pass rate ≥95%.<br>RU: MTTR ≤5 мин; покрытие circuit breaker ≥90%; успешность хаос-тестов ≥95%. |
| **Положительные примеры** | 1. Retries with backoff.<br>2. Circuit breaker.<br>3. Bulkheads.<br>4. Fault injection.<br>5. Load shedding. |
| **Отрицательные примеры** | 1. Отсутствие таймаутов.<br>2. Нет graceful shutdown.<br>3. Один сервис перегружает кластер.<br>4. Нет лимитов ресурсов.<br>5. Тесты только happy path. |
| **Риски нарушения** | Каскадные аварии, нарушение доступности. |
| **Методика проверки** | Chaos-эксперименты, анализ политик. |
| **Статус** | **CORE** |

---

## **Принцип 9. Data Quality & Consistency / Качество и согласованность данных**

| Поле | Описание |
|------|----------|
| **Принцип** | Data Quality & Consistency |
| **Мотивация** | Данные — главный актив банка. |
| **Метрики** | EN: Data validation ≥98%; Eventual consistency ≤2 min; Data drift =0.<br>RU: покрытие валидации ≥98%; согласованность ≤2 мин; дрейф =0. |
| **Положительные примеры** | 1. Валидация входящих данных.<br>2. Outbox.<br>3. Materialized views.<br>4. Доменные события.<br>5. Data Quality Monitoring. |
| **Отрицательные примеры** | 1. Null без обработки.<br>2. Разные бизнес-правила в сервисах.<br>3. Неконсистентные статусы.<br>4. События с внутренними сущностями.<br>5. Запись в чужую БД. |
| **Риски нарушения** | Финансовые ошибки, регуляторные инциденты. |
| **Методика проверки** | DQ-сканеры, сравнение моделей, сценарные тесты. |
| **Статус** | **CORE** |

---

## **Принцип 10. AI-Augmented Engineering / Инжиниринг, дополненный ИИ**

| Поле | Описание |
|------|----------|
| **Принцип** | AI-Augmented Engineering |
| **Мотивация** | Оптимизация разработки и тестирования. |
| **Метрики** | EN: AI code review ≥90%; AI test coverage ≥50%; Pre-commit defect detection ≥85%.<br>RU: авто-ревью ≥90%; ИИ-тесты ≥50%; дефекты до коммита ≥85%. |
| **Положительные примеры** | 1. Генерация тестов ИИ.<br>2. Авто-ревью.<br>3. Рекомендации архитектуры.<br>4. Анализ логов ИИ.<br>5. Генерация документации. |
| **Отрицательные примеры** | 1. Нет AI-quality-gate.<br>2. Ручная генерация шаблонного кода.<br>3. Отсутствие ИИ-аналитики логов.<br>4. Использование несертифицированных моделей.<br>5. Игнорирование результатов анализа. |
| **Риски нарушения** | Рост дефектов, снижение темпа разработки. |
| **Методика проверки** | Audit trail ИИ-инструментов, пайплайны. |
| **Статус** | **OPTIONAL** |

---

# **SLA / SLO (общие требования)**

| Параметр | Цель |
|---------|------|
| **Availability SLO** | ≥ 99.95% для клиентских сервисов; ≥ 99.99% для Core IT |
| **Latency SLO (p95)** | ≤ 150 мс для синхронных API |
| **Event Delivery SLO** | ≥ 99.99% в течение 2 минут |
| **Error Budget** | 0.05% для клиентских сервисов |
| **Recovery SLO (MTTR)** | ≤ 5 минут |

---

## **Конец документа**
